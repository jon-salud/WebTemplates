---
import { templateBlueprints } from '../../config/templateFamilies';
import type { IndustryConfig } from '../../config/industries';
import { Hero, Services, Benefits, Testimonials, CTA, LogoMarquee, Footer } from '../sections';
// custom sections
import AwardsBadges from '../sections/custom/AwardsBadges.astro';
import MenuPreview from '../sections/custom/MenuPreview.astro';
import ProcessSteps from '../sections/custom/ProcessSteps.astro';
import CertificationStrip from '../sections/custom/CertificationStrip.astro';
import ClientMarquee from '../sections/custom/ClientMarquee.astro';
import ShowcaseGallery from '../sections/custom/ShowcaseGallery.astro';
import AnimatedLogoSection from '../sections/AnimatedLogoSection.astro';

export interface Props {
  industryConfig: IndustryConfig;
}

const { industryConfig } = Astro.props as Props;
const family = industryConfig.templateFamily || 'professionalServices';
const blueprint = templateBlueprints[family] || [];

const getSectionOverride = (component: string) => {
  return (industryConfig.sections && (industryConfig.sections as any)[component]) || null;
};

const resolveVariant = (bp: any) => {
  const override = getSectionOverride(bp.component);
  return override?.variant || bp.variant || undefined;
};

const resolveProps = (bp: any) => {
  const override = getSectionOverride(bp.component);
  return { ...(bp.props || {}), ...(override?.props || {}) };
};

// Build a simple descriptor list for rendering in the template below.
const renderedSections = blueprint.map((bp) => {
  if (bp.component === 'Custom') {
    const comp = (bp.props && (bp.props as any).component) || undefined;
    return { name: comp || 'Custom', props: resolveProps(bp), variant: resolveVariant(bp) };
  }
  return { name: bp.component, props: resolveProps(bp), variant: resolveVariant(bp) };
});
---

<div>
  {renderedSections.map((rs, i) => {
    const props = rs.props || {};
    const variant = rs.variant;

    if (rs.name === 'Hero') return <Hero key={i} client:load industry={industryConfig} variant={variant} {...props} />;
    if (rs.name === 'Services') return <Services key={i} client:visible industry={industryConfig} variant={variant} {...props} />;
    if (rs.name === 'Benefits') return <Benefits key={i} client:visible industry={industryConfig} variant={variant} {...props} />;
    if (rs.name === 'Testimonials') return <Testimonials key={i} client:visible industry={industryConfig} variant={variant} {...props} />;
    if (rs.name === 'CTA') return <CTA key={i} client:visible industry={industryConfig} variant={variant} {...props} />;
    if (rs.name === 'LogoMarquee') return <LogoMarquee key={i} client:visible industry={industryConfig} {...props} />;
    if (rs.name === 'Footer') return <Footer key={i} client:visible industry={industryConfig} {...props} />;

    // custom
    if (rs.name === 'AwardsBadges') return <AwardsBadges key={i} industry={industryConfig} {...props} />;
    if (rs.name === 'MenuPreview') return <MenuPreview key={i} industry={industryConfig} {...props} />;
    if (rs.name === 'ProcessSteps') return <ProcessSteps key={i} industry={industryConfig} {...props} />;
    if (rs.name === 'CertificationStrip') return <CertificationStrip key={i} industry={industryConfig} {...props} />;
    if (rs.name === 'ClientMarquee') return <ClientMarquee key={i} industry={industryConfig} {...props} />;
    if (rs.name === 'ShowcaseGallery') return <ShowcaseGallery key={i} industry={industryConfig} {...props} />;
    if (rs.name === 'AnimatedLogoSection') return <AnimatedLogoSection key={i} industry={industryConfig} {...props} />;

    return null;
  })}
</div>
